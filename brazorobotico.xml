<!--basándonos en el código proporcionado por el equipo docente-->
<!--se crea el modelo con nombre "brazorobotico"-->
<mujoco model="brazorobotico">

  <!--se setean las unidades de los ángulos a radianes y el repositorio de donde se sacarán los modelos-->
  <compiler angle="radian" meshdir="modelos" autolimits="true"/>

 <!--se crean las configuraciones generales del brazo, como la resistencia al giro y la inercia del motor-->
  <default>
    <default class="brazo">
      <geom friction="0.2" margin="0.001"/>
      <joint type="hinge" damping="1.0" armature="0.01"/> 
      <position kp="15" ctrlrange="-3.141592 3.141592" forcerange="-7 7"/>


     <!--las configuraciones básicas para los joints (uniones):-->

     <!--creamos la base, con un rango de rotación entre 0 y pi/2 y rota en z positivo (0 0 1)-->
      <default class="base">
        <joint type="hinge" range="0 3.14" axis="0 0 1"/>
        <position ctrlrange="0 3.14"/>
      </default>
        
     <!--repetimos lo anterior para los otros joints (motores) del brazo robótico-->
      <default class="joint1"> <!--joint que permite rotación entre base y cintura-->
        <joint type="hinge" range="0 3.14" axis="0 0 1"/>
        <position ctrlrange="0 3.14"/>
      </default>

      <default class="joint2"> <!--joint que permite rotación entre cintura y hombro-->
        <joint type="hinge" range="0 3.14" axis="0 0 1"/>
        <position ctrlrange="0 3.14"/>
      </default>

      <default class="joint3"> <!--joint que permite rotación del codo sobre si mismo-->
        <joint type="hinge" range="0 3.14" axis="0 0 1"/>
        <position ctrlrange="0 3.14"/>
      </default>

      <default class="joint4"> <!--joint que permite rotación entre muñeca y gripper-->
        <joint type="hinge" range="0 3.14" axis="0 0 1"/>
        <position ctrlrange="0 3.14"/>
      </default>

      <default class="joint5"> <!--joint que permite rotación del gripper sobre si mismo-->
        <joint type="hinge" range="0 3.14" axis="0 0 1"/>
        <position ctrlrange="0 3.14"/>
      </default>

     <!--generamos las configuraciones por defecto visuales-->
      <default class="visual">
        <geom type="mesh" contype="0" conaffinity="0" group="2" material="default_material"/>
      </default>
    </default>
  </default>


 <!--falta poner colores a cada cuerpo-->
  <asset>
    <material name="gris" specular="0.5" shininess="0.25" rgba="0.6 0.6 0.6 1"/>
    <material name="azul" specular="0.5" shininess="0.25" rgba="0.2 0.5 0.8 1"/>
    <material name="verde" specular="0.5" shininess="0.25" rgba="0.3 0.6 0.3 1"/>
    <material name="naranja" specular="0.5" shininess="0.25" rgba="0.9 0.4 0.1 1"/>
    <material name="rojo" specular="0.5" shininess="0.25" rgba="0.6 0.4 0.3 1"/>


   <!--cargamos las mallas (modelos 3D)-->
    <mesh class="brazo" file="base.obj"/>
    <mesh class="brazo" file="link1.obj"/>
    <mesh class="brazo" file="cintura.obj"/>
    <mesh class="brazo" file="link2.obj"/>
    <mesh class="brazo" file="hombro.obj"/>
    <mesh class="brazo" file="link3.obj"/>
    <mesh class="brazo" file="codo.obj"/>
    <mesh class="brazo" file="muñeca.obj"/>
    <mesh class="brazo" file="gripper.obj"/>
    </asset>


 <!--en la siguiente sección vamos a generar el brazo robótico como tal-->
  <worldbody>

   <!--generamos iluminación de la escena-->
    <light name="spotlight" mode="targetbodycom" target="base_brazo" pos="0 -1 2"/>

   <!--iniciamos cargando la base como "hija" del brazo, estará en el origen del sistema (se relaciona con el cuerpo padre (brazo)-->
    <body name="base_brazo" pos="0 0 0" childclass="brazo">

     <!--definimos una inercia-->
      <inertial mass="1.5" pos="0 0 0.05" diaginertia="0.01 0.01 0.02"/>

     <!--conectamos a la base con el primer joint (le dara el grado de libertad de girar con respecto al eje z)-->
      <joint class="base" name="base_joint"/>

     <!--asociamos la base a la geometría visible del cuerpo-->
      <geom type="mesh" mesh="base" material="rojo" group="1"/>

     
     <!--ahora necesitamos anidar al resto de partes del brazo-->

     <!--primero generamos el primer link-->
      
      <body name="link1_brazo" pos="0 0 0.106"> 
        <inertial mass="1.0" pos="0 0 0.045" diaginertia="0.008 0.008 0.01"/>
        <joint class="joint1" name="link1_joint"/>
        <geom type="mesh" mesh="link1" material="verde" group="1"  axisangle="1 0 0 1.5708"/> <!--giramos el sistema coordenado DE LA GEOMETRÍA para poder colocar el link 1 horizontal-->

        <body name="cintura_brazo" pos="0 0 0.01"> <!--posicionamos la base de la cintura en el extremo del primer link-->
            <inertial mass="2.5" pos="0 0 0.17" diaginertia="0.05 0.05 0.01"/>
          <joint class="joint2" name="cintura_joint"/>
            <geom type="mesh" mesh="cintura" material="verde" group="1" />

            <body name="link2_brazo" pos="0 0 0.344"> <!--posicionamos el inicio del segundo link al final de la cintura-->
                <inertial mass="2.0" pos="0 0 0.175" diaginertia="0.04 0.04 0.008"/>
                <joint class="joint2" name="link2_joint"/>
                <geom type="mesh" mesh="link2" material="azul" group="1" axisangle="1 0 0 -1.5708"/> <!--rotamos en -90 grados-->

                <body name="codo_brazo" pos="0 0 0.1205">
                    <inertial mass="0.5" pos="0 0 0.05" diaginertia="0.002 0.002 0.001"/>
                    <joint class="joint3" name="codo_joint"/>
                    <geom type="mesh" mesh="codo" group="1"/>

                    <body name="link3_brazo" pos="0 0 0.35">
                        <inertial mass="0.3" pos="0 0 0.025" diaginertia="0.001 0.001 0.0005"/>
                        <joint class="joint4" name="link3_joint"/>
                        <geom type="mesh" mesh="link3" material="gris" group="1" axisangle="1 0 0 1.5708"/>
                        
                          <body name="muñeca_brazo" pos="0 0 0.11">
                            <inertial mass="0.5" pos="0 0 0.05" diaginertia="0.002 0.002 0.001"/>
                            <joint class="joint4" name="muñeca_joint"/>
                            <geom type="mesh" mesh="muñeca" material="naranja" group="1" />

                              <body name="gripper_brazo" pos="0 0 0.1">
                                <inertial mass="0.5" pos="0 0 0.05" diaginertia="0.002 0.002 0.001"/>
                                <joint class="joint5" name="gripper_joint"/>
                                <geom type="mesh" mesh="gripper" material="verde" group="1"/>

                                <site name="end_effector" pos="0 0 0.05" size="0.01"/>
                              </body>
                          </body>
                    </body>
                </body>
            </body>
        </body>
      </body>
    </body>
  </worldbody>

<!--desactivamos las colisiones-->  
  <contact>
  <exclude body1="base_brazo" body2="link1_brazo"/>
  <exclude body1="link1_brazo" body2="cintura_brazo"/>
  <exclude body1="cintura_brazo" body2="link2_brazo"/>
  <exclude body1="link2_brazo" body2="codo_brazo"/>
  <exclude body1="codo_brazo" body2="link3_brazo"/>
  <exclude body1="link3_brazo" body2="muñeca_brazo"/>
  <exclude body1="muñeca_brazo" body2="gripper_brazo"/>
 </contact>



<!--se generan los actuadores (motores a actuar en cada joint definido)\-->  
  <actuator>
    <position class="base" name="actuador_base" joint="base_joint"/>
    <position class="joint1" name="actuador_link1" joint="link1_joint"/>
    <position class="joint2" name="actuador_cintura" joint="cintura_joint"/>
    <position class="joint2" name="actuador_link2" joint="link2_joint"/>
    <position class="joint3" name="actuador_codo" joint="codo_joint"/>
    <position class="joint4" name="actuador_link3" joint="link3_joint"/>
    <position class="joint4" name="actuador_muñeca" joint="muñeca_joint"/>
    <position class="joint5" name="actuador_gripper" joint="gripper_joint"/>
  </actuator>
        
        <visual>
    <global offheight="600" offwidth="800"/>
    </visual>
        
  <keyframe>
    <key name="home" qpos="0 0 0 0 0 0 0 0 "
      ctrl=" 0 0 0 0 0 0 0 0 "/>
  </keyframe>
        
</mujoco>

  
